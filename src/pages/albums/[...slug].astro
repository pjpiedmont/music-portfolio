---
import type { ImageMetadata } from "astro";
import { Image } from "astro:assets";
import { getCollection, render } from "astro:content";

export async function getStaticPaths() {
	const albums = await getCollection("albums");
	return albums.map((album) => ({
		params: { slug: album.id },
		props: { album },
	}));
}

const { album } = Astro.props;
const { Content } = await render(album);

const images = import.meta.glob<{ default: ImageMetadata }>(
	"@assets/albumArt/*.{jpeg,jpg,png,gif}",
);
const albumArtSrc = `/src/assets/albumArt/${album.data.albumArt.filename}`;
if (!images[albumArtSrc])
	throw new Error(
		`"${albumArtSrc}" does not exist in glob: "src/assets/albumArt/*.{jpeg,jpg,png,gif}"`,
	);
---

<h1>{album.data.title}</h1>
<Image src={images[albumArtSrc]()} alt={album.data.albumArt.alt} />
<p>Album art by {album.data.albumArt.artist}</p>
